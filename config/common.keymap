#include <behaviors.dtsi>
#include <dt-bindings/zmk/keys.h>
#include <dt-bindings/zmk/bt.h>
#include <dt-bindings/zmk/ext_power.h>
#include "includes/mods.dtsi"
#include "includes/combos.dtsi"
#include "includes/morphs.dtsi"

#define BASE  0
#define LOWER 1
#define RAISE 2
#define FUN   3

&mt {
  tapping-term-ms = <200>;
};

&lt {  // layer-tap config
  flavor = "balanced";
  tapping-term-ms = <200>;
  quick-tap-ms = <175>;
};


/ {
 
  keymap {
    compatible = "zmk,keymap";

    default_layer {
      bindings = <
//    ╭───────────────┬─────────────┬─────────────┬──────────────┬───────────────┬───────────────╮                                   ╭────────────────┬───────────────┬──────────────┬─────────────┬─────────────┬───────╮
//    │       `       │      1      │      2      │      3       │       4       │       5       │                                   │       6        │       7       │      8       │      9      │      0      │   -   │
//    ├───────────────┼─────────────┼─────────────┼──────────────┼───────────────┼───────────────┤                                   ├────────────────┼───────────────┼──────────────┼─────────────┼─────────────┼───────┤
//    │      TAB      │      Q      │      W      │      E       │       R       │       T       │                                   │       Y        │       U       │      I       │      O      │      P      │   +   │
//    ├───────────────┼─────────────┼─────────────┼──────────────┼───────────────┼───────────────┤                                   ├────────────────┼───────────────┼──────────────┼─────────────┼─────────────┼───────┤
//    │ &mt LCTRL ESC │ &hml LGUI A │ &hml LALT S │ &hml LCTRL D │ &hml LSHIFT F │       G       │                                   │       H        │ &hmr LSHIFT J │ &hmr LCTRL K │ &hmr LALT L │ &hmr RGUI ' │   ;   │
//    ├───────────────┼─────────────┼─────────────┼──────────────┼───────────────┼───────────────┼────────────────┬──────────────────┼────────────────┼───────────────┼──────────────┼─────────────┼─────────────┼───────┤
//    │     LSHFT     │      Z      │      X      │      C       │       V       │       B       │       [        │        ]         │       N        │       M       │ &comma_morph │ &dot_morph  │      /      │ RSHFT │
//    ╰───────────────┴─────────────┼─────────────┼──────────────┼───────────────┼───────────────┼────────────────┼──────────────────┼────────────────┼───────────────┼──────────────┼─────────────┼─────────────┴───────╯
//                                  │    LCTRL    │     LALT     │ &tm LGUI TAB  │ &lt LOWER ESC │ &tm LSHIFT RET │ &tm RSHIFT SPACE │ &lt RAISE BSPC │  &lt FUN DEL  │      [       │      ]      │                      
//                                  ╰─────────────┴──────────────┴───────────────┴───────────────┴────────────────┴──────────────────┴────────────────┴───────────────┴──────────────┴─────────────╯                      
  &kp GRAVE       &kp N1        &kp N2        &kp N3         &kp N4          &kp N5                                              &kp N6           &kp N7          &kp N8         &kp N9        &kp N0          &kp MINUS
  &kp TAB         &kp Q         &kp W         &kp E          &kp R           &kp T                                               &kp Y            &kp U           &kp I          &kp O         &kp P           &kp PLUS 
  &mt LCTRL ESC   &hml LGUI A   &hml LALT S   &hml LCTRL D   &hml LSHIFT F   &kp G                                               &kp H            &hmr LSHIFT J   &hmr LCTRL K   &hmr LALT L   &hmr RGUI SQT   &kp SEMI 
  &kp LSHFT       &kp Z         &kp X         &kp C          &kp V           &kp B           &kp LBKT         &kp RBKT           &kp N            &kp M           &comma_morph   &dot_morph    &kp FSLH        &kp RSHFT
                                &kp LCTRL     &kp LALT       &tm LGUI TAB    &lt LOWER ESC   &tm LSHIFT RET   &tm RSHIFT SPACE   &lt RAISE BSPC   &lt FUN DEL     &kp LBKT       &kp RBKT                               
      >;
      sensor-bindings = <&inc_dec_kp C_VOL_UP C_VOL_DN>;
    };

    lower_layer {
      bindings = <
//    ╭────────┬──────────┬──────────┬──────────┬──────────┬──────────╮       ╭────┬────┬────┬─────┬─────┬─────╮
//    │ BT_CLR │ BT_SEL 0 │ BT_SEL 1 │ BT_SEL 2 │ BT_SEL 3 │ BT_SEL 4 │       │    │    │    │     │     │     │
//    ├────────┼──────────┼──────────┼──────────┼──────────┼──────────┤       ├────┼────┼────┼─────┼─────┼─────┤
//    │   F1   │    F2    │    F3    │    F4    │    F5    │    F6    │       │ F7 │ F8 │ F9 │ F10 │ F11 │ F12 │
//    ├────────┼──────────┼──────────┼──────────┼──────────┼──────────┤       ├────┼────┼────┼─────┼─────┼─────┤
//    │   `    │    !     │    @     │    #     │    $     │    %     │       │ ^  │ &  │ *  │  (  │  )  │  ~  │
//    ├────────┼──────────┼──────────┼──────────┼──────────┼──────────┼───┬───┼────┼────┼────┼─────┼─────┼─────┤
//    │        │  EP_ON   │  EP_OFF  │    🔌    │          │          │   │   │    │ -  │ +  │  [  │  \  │  |  │
//    ╰────────┴──────────┼──────────┼──────────┼──────────┼──────────┼───┼───┼────┼────┼────┼─────┼─────┴─────╯
//                        │          │          │   LGUI   │          │   │   │    │    │    │     │            
//                        ╰──────────┴──────────┴──────────┴──────────┴───┴───┴────┴────┴────┴─────╯            
  &bt BT_CLR   &bt BT_SEL 0       &bt BT_SEL 1        &bt BT_SEL 2        &bt BT_SEL 3   &bt BT_SEL 4                     &trans      &trans      &trans     &trans     &trans     &trans   
  &kp F1       &kp F2             &kp F3              &kp F4              &kp F5         &kp F6                           &kp F7      &kp F8      &kp F9     &kp F10    &kp F11    &kp F12  
  &kp GRAVE    &kp EXCL           &kp AT              &kp HASH            &kp DOLLAR     &kp PRCNT                        &kp CARET   &kp AMPS    &kp STAR   &kp LPAR   &kp RPAR   &kp TILDE
  &trans       &ext_power EP_ON   &ext_power EP_OFF   &ext_power EP_TOG   &trans         &trans         &trans   &trans   &trans      &kp MINUS   &kp PLUS   &kp LBRC   &kp BSLH   &kp PIPE 
                                  &trans              &trans              &kp LGUI       &trans         &trans   &trans   &trans      &trans      &trans     &trans                         
      >;
      sensor-bindings = <&inc_dec_kp C_VOL_UP C_VOL_DN>;
    };

    raise_layer {
      bindings = <
//    ╭───┬───┬───┬───┬───┬───╮                ╭───┬───┬───┬───┬──────┬───╮
//    │   │   │   │   │   │   │                │   │   │   │   │      │   │
//    ├───┼───┼───┼───┼───┼───┤                ├───┼───┼───┼───┼──────┼───┤
//    │ ` │ 1 │ 2 │ 3 │ 4 │ 5 │                │ 6 │ 7 │ 8 │ 9 │  0   │   │
//    ├───┼───┼───┼───┼───┼───┤                ├───┼───┼───┼───┼──────┼───┤
//    │   │   │   │   │   │   │                │ ← │ ↓ │ ↑ │ → │ RGUI │   │
//    ├───┼───┼───┼───┼───┼───┼───┬────────────┼───┼───┼───┼───┼──────┼───┤
//    │   │   │   │   │   │   │   │            │ + │ - │ ( │ ) │  |   │   │
//    ╰───┴───┼───┼───┼───┼───┼───┼────────────┼───┼───┼───┼───┼──────┴───╯
//            │   │   │   │   │   │ &caps_word │   │   │ [ │ ] │           
//            ╰───┴───┴───┴───┴───┴────────────┴───┴───┴───┴───╯           
  &trans      &trans   &trans   &trans   &trans   &trans                         &trans        &trans      &trans     &trans      &trans     &trans
  &kp GRAVE   &kp N1   &kp N2   &kp N3   &kp N4   &kp N5                         &kp N6        &kp N7      &kp N8     &kp N9      &kp N0     &trans
  &trans      &trans   &trans   &trans   &trans   &trans                         &kp LEFT      &kp DOWN    &kp UP     &kp RIGHT   &kp RGUI   &trans
  &trans      &trans   &trans   &trans   &trans   &trans   &trans   &trans       &kp KP_PLUS   &kp MINUS   &kp LPAR   &kp RPAR    &kp PIPE   &trans
                       &trans   &trans   &trans   &trans   &trans   &caps_word   &trans        &trans      &kp LBRC   &kp RBRC                     
      >;
      sensor-bindings = <&inc_dec_kp C_VOL_UP C_VOL_DN>;
    };

    fun_layer {
      bindings = <
//    ╭───┬─────┬────┬────┬────┬───────╮       ╭──────────┬──────────┬──────────┬──────────┬────────┬───╮
//    │   │     │    │    │    │       │       │          │          │          │          │        │   │
//    ├───┼─────┼────┼────┼────┼───────┤       ├──────────┼──────────┼──────────┼──────────┼────────┼───┤
//    │   │ F12 │ F7 │ F8 │ F9 │ PSCRN │       │    🔌    │    🔅    │    🔆    │          │   ⏯︎    │   │
//    ├───┼─────┼────┼────┼────┼───────┤       ├──────────┼──────────┼──────────┼──────────┼────────┼───┤
//    │   │ F11 │ F4 │ F5 │ F6 │       │       │    ⏴︎     │    🔉    │    🔊    │    ⏵︎     │   🔇   │   │
//    ├───┼─────┼────┼────┼────┼───────┼───┬───┼──────────┼──────────┼──────────┼──────────┼────────┼───┤
//    │   │ F10 │ F1 │ F2 │ F3 │       │   │   │ BT_SEL 0 │ BT_SEL 1 │ BT_SEL 2 │ BT_SEL 3 │ BT_CLR │   │
//    ╰───┴─────┼────┼────┼────┼───────┼───┼───┼──────────┼──────────┼──────────┼──────────┼────────┴───╯
//              │    │    │    │       │   │   │          │          │          │          │             
//              ╰────┴────┴────┴───────┴───┴───┴──────────┴──────────┴──────────┴──────────╯             
  &trans   &trans    &trans   &trans   &trans   &trans                        &trans              &trans         &trans         &trans         &trans       &trans
  &trans   &kp F12   &kp F7   &kp F8   &kp F9   &kp PSCRN                     &ext_power EP_TOG   &kp C_BRI_DN   &kp C_BRI_UP   &trans         &kp C_PP     &trans
  &trans   &kp F11   &kp F4   &kp F5   &kp F6   &trans                        &kp C_PREV          &kp C_VOL_DN   &kp C_VOL_UP   &kp C_NEXT     &kp C_MUTE   &trans
  &trans   &kp F10   &kp F1   &kp F2   &kp F3   &trans      &trans   &trans   &bt BT_SEL 0        &bt BT_SEL 1   &bt BT_SEL 2   &bt BT_SEL 3   &bt BT_CLR   &trans
                     &trans   &trans   &trans   &trans      &trans   &trans   &trans              &trans         &trans         &trans                            
      >;
      sensor-bindings = <&inc_dec_kp C_VOL_UP C_VOL_DN>;
    };

    num_layer {
      bindings = <
//    ╭───┬───┬───┬───┬───┬───╮       ╭───┬───┬───┬───┬───┬───╮
//    │   │   │   │   │   │   │       │   │   │   │   │   │   │
//    ├───┼───┼───┼───┼───┼───┤       ├───┼───┼───┼───┼───┼───┤
//    │   │   │ 7 │ 8 │ 9 │   │       │   │   │   │   │   │   │
//    ├───┼───┼───┼───┼───┼───┤       ├───┼───┼───┼───┼───┼───┤
//    │   │   │ 4 │ 5 │ 6 │   │       │   │   │   │   │   │   │
//    ├───┼───┼───┼───┼───┼───┼───┬───┼───┼───┼───┼───┼───┼───┤
//    │   │   │ 1 │ 2 │ 3 │   │   │   │   │   │   │   │   │   │
//    ╰───┴───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┴───╯
//            │   │   │   │   │   │   │   │   │   │   │        
//            ╰───┴───┴───┴───┴───┴───┴───┴───┴───┴───╯        
  &trans   &trans   &trans   &trans   &trans   &trans                     &trans   &trans   &trans   &trans   &trans   &trans
  &trans   &trans   &kp N7   &kp N8   &kp N9   &trans                     &trans   &trans   &trans   &trans   &trans   &trans
  &trans   &trans   &kp N4   &kp N5   &kp N6   &trans                     &trans   &trans   &trans   &trans   &trans   &trans
  &trans   &trans   &kp N1   &kp N2   &kp N3   &trans   &trans   &trans   &trans   &trans   &trans   &trans   &trans   &trans
                    &trans   &trans   &trans   &trans   &trans   &trans   &trans   &trans   &trans   &trans                  
      >;
      sensor-bindings = <&inc_dec_kp C_VOL_UP C_VOL_DN>;
    };

    empty_layer {
      bindings = <
//    ╭───┬───┬───┬───┬───┬───╮       ╭───┬───┬───┬───┬───┬───╮
//    │   │   │   │   │   │   │       │   │   │   │   │   │   │
//    ├───┼───┼───┼───┼───┼───┤       ├───┼───┼───┼───┼───┼───┤
//    │   │   │   │   │   │   │       │   │   │   │   │   │   │
//    ├───┼───┼───┼───┼───┼───┤       ├───┼───┼───┼───┼───┼───┤
//    │   │   │   │   │   │   │       │   │   │   │   │   │   │
//    ├───┼───┼───┼───┼───┼───┼───┬───┼───┼───┼───┼───┼───┼───┤
//    │   │   │   │   │   │   │   │   │   │   │   │   │   │   │
//    ╰───┴───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┼───┴───╯
//            │   │   │   │   │   │   │   │   │   │   │        
//            ╰───┴───┴───┴───┴───┴───┴───┴───┴───┴───╯        
  &trans   &trans   &trans   &trans   &trans   &trans                     &trans   &trans   &trans   &trans   &trans   &trans
  &trans   &trans   &trans   &trans   &trans   &trans                     &trans   &trans   &trans   &trans   &trans   &trans
  &trans   &trans   &trans   &trans   &trans   &trans                     &trans   &trans   &trans   &trans   &trans   &trans
  &trans   &trans   &trans   &trans   &trans   &trans   &trans   &trans   &trans   &trans   &trans   &trans   &trans   &trans
                    &trans   &trans   &trans   &trans   &trans   &trans   &trans   &trans   &trans   &trans                  
      >;
      sensor-bindings = <&inc_dec_kp C_VOL_UP C_VOL_DN>;
    };
  };
};
